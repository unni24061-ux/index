<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PPL Pro Tracker</title>

  <style>
    :root { --primary: #3b82f6; --success: #10b981; --danger: #ef4444; --bg: #f3f4f7; --dark: #1e293b; }
    body { font-family: -apple-system, system-ui, sans-serif; margin: 0; background: var(--bg); color: #1f2937; }
    
    header { background: white; padding: 16px; font-weight: 700; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }

    .page { display: none; padding: 12px; padding-bottom: 120px; max-width: 500px; margin: 0 auto; }
    .page.active { display: block; }

    .motivation-box { background: var(--dark); color: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; font-style: italic; font-size: 13px; text-align: center; }

    /* Edit Mode */
    .edit-controls { position: absolute; inset: 0; background: rgba(0,0,0,0.7); border-radius: 10px; display: none; align-items: center; justify-content: center; gap: 10px; z-index: 5; }
    .edit-mode .edit-controls { display: flex; }
    .icon-btn { background: white; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 14px; cursor: pointer; }
    @keyframes shake { 0%{transform:rotate(0)} 25%{transform:rotate(1deg)} 75%{transform:rotate(-1deg)} 100%{transform:rotate(0)} }
    .edit-mode .quick-block { animation: shake 0.3s infinite; background: #94a3b8; }

    /* Exercise Card */
    .exercise-card { background: white; border-radius: 16px; padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); overflow: hidden; transition: all 0.3s ease; }
    .exercise-card.minimized { background: #f0fdf4; border: 1px solid var(--success); padding: 10px 15px; }
    
    /* SET ROW with PR Logic */
    .set-row { display: grid; grid-template-columns: 20px 50px 1fr 1fr 20px; gap: 8px; align-items: center; margin-top: 8px; padding: 8px; background: #f9fafb; border-radius: 8px; }
    .pr-ghost { font-size: 9px; color: #9ca3af; opacity: 0.7; font-weight: bold; text-align: center; }
    .set-row input { width: 100%; border: 1px solid #ddd; border-radius: 5px; padding: 5px; text-align: center; font-size: 13px; }

    /* Stats & Chart */
    .stats-card { background: white; padding: 16px; border-radius: 16px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
    .metrics-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
    .metrics-grid input { width: 100%; padding: 8px; border: 1px solid #eee; border-radius: 8px; text-align: center; font-weight: bold; color: var(--primary); }
    
    .chart-container { height: 100px; display: flex; align-items: flex-end; gap: 6px; margin-top: 20px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
    .bar { background: var(--primary); flex: 1; border-radius: 3px 3px 0 0; position: relative; min-width: 15px; }
    .bar::after { content: attr(data-val); position: absolute; top: -18px; left: 50%; transform: translateX(-50%); font-size: 9px; font-weight: bold; }

    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
    .modal { background: white; width: 100%; max-width: 400px; padding: 25px; border-radius: 20px; text-align: center; }

    nav { display: flex; background: white; border-top: 1px solid #e5e7eb; position: fixed; bottom: 0; width: 100%; justify-content: space-around; padding: 12px 0; z-index: 1000; }
    nav button { background: none; border: none; font-weight: 700; color: #94a3b8; }
    nav button.active { color: var(--primary); }

    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 10px; }
    .cal-cell { aspect-ratio: 1; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; background: #e5e7eb; cursor: pointer; }
    .cal-cell.worked { background: var(--success); color: white; }
  </style>
</head>
<body>

<header>PPL Pro Tracker</header>

<div id="categoryPage" class="page active">
  <div class="motivation-box" id="mote-top">"Loading greatness..."</div>
  <div class="category-grid" style="display:grid; gap:12px">
    <div onclick="openWorkout('Push')" style="background:white; padding:25px; border-radius:16px; font-weight:bold; font-size:18px; box-shadow:0 4px 6px rgba(0,0,0,0.05); cursor:pointer;">üöÄ PUSH</div>
    <div onclick="openWorkout('Pull')" style="background:white; padding:25px; border-radius:16px; font-weight:bold; font-size:18px; box-shadow:0 4px 6px rgba(0,0,0,0.05); cursor:pointer;">üé£ PULL</div>
    <div onclick="openWorkout('Legs')" style="background:white; padding:25px; border-radius:16px; font-weight:bold; font-size:18px; box-shadow:0 4px 6px rgba(0,0,0,0.05); cursor:pointer;">ü¶µ LEGS</div>
  </div>
</div>

<div id="workoutPage" class="page">
  <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
    <button onclick="goHome()" style="background:none; border:none; color:var(--primary); font-weight:bold;">‚Üê Back</button>
    <button onclick="toggleEditMode()" id="editBtn" style="background:#eee; border:none; padding:5px 12px; border-radius:8px; font-size:11px; font-weight:bold;">Edit Mode</button>
  </div>
  <div id="quickBlocks" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px;"></div>
  <div id="exerciseList"></div>
  <button id="sessionFinishBtn" onclick="finishSession()" style="width:100%; padding:15px; background:var(--success); color:white; border:none; border-radius:12px; font-weight:bold; display:none;">FINISH SESSION üèÜ</button>
</div>

<div id="progressionPage" class="page">
  <div class="stats-card">
    <h4 style="margin-top:0;">Body Profile</h4>
    <div class="metrics-grid">
        <div><small>Height</small><input type="number" id="m-height" placeholder="cm" onchange="updateMetric('height', this.value)"></div>
        <div><small>Goal</small><input type="number" id="m-goal" placeholder="kg" onchange="updateMetric('goal', this.value)"></div>
        <div><small>Weight</small><input type="number" id="m-weight" placeholder="kg" onchange="updateMetric('weight', this.value)"></div>
    </div>
  </div>

  <div class="stats-card">
    <h4 style="margin:0;">Weekly Weight Entry</h4>
    <div style="display:flex; gap:10px; margin-top:10px;">
        <input type="number" id="week-end-weight" placeholder="End of week (kg)" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:10px;">
        <button onclick="logWeight()" style="background:var(--primary); color:white; border:none; padding:0 15px; border-radius:10px; font-weight:bold;">Log</button>
    </div>
    <div class="chart-container" id="weightChart"></div>
  </div>

  <div class="stats-card">
    <h4 style="margin:0;">Workout History</h4>
    <p style="font-size: 10px; color: #666; margin: 5px 0;">Tap to see Personal Records for that day</p>
    <div class="calendar-grid" id="calendarGrid"></div>
  </div>
</div>

<div id="motivationPopup" class="overlay" onclick="this.style.display='none'">
    <div class="modal" onclick="event.stopPropagation()">
        <div style="font-size:50px;">üî•</div>
        <h2 id="moteTitle">BEAST MODE!</h2>
        <p id="moteQuote" style="font-style:italic; font-size:18px; margin:20px 0;"></p>
        <button onclick="document.getElementById('motivationPopup').style.display='none'" style="width:100%; padding:12px; background:var(--primary); color:white; border:none; border-radius:10px; font-weight:bold;">KEEP CRUSHING IT</button>
    </div>
</div>

<div id="historyPopup" class="overlay" onclick="this.style.display='none'">
    <div class="modal" onclick="event.stopPropagation()">
        <h3 id="histDate">Details</h3>
        <p style="font-size: 11px; color: var(--success); margin-bottom: 10px;">Daily Personal Records</p>
        <div id="histBody" style="text-align:left; max-height:300px; overflow-y:auto;"></div>
        <button onclick="document.getElementById('historyPopup').style.display='none'" style="width:100%; margin-top:15px; padding:10px; background:var(--dark); color:white; border:none; border-radius:10px;">Close</button>
    </div>
</div>

<nav>
  <button id="nav-home" onclick="goHome()" class="active">WORKOUT</button>
  <button id="nav-prog" onclick="showProgression()">PROGRESSION</button>
</nav>

<script>
const quotes = ["No pain, no gain!", "Stay consistent!", "Shut up and train.", "Sore today, strong tomorrow.", "Keep pushing!"];

let state = JSON.parse(localStorage.getItem('gymPPL_vUltimate')) || {
    customExercises: { 'Push': ['Bench Press'], 'Pull': ['Pull Ups'], 'Legs': ['Squats'] },
    currentExercises: [], history: [], metrics: { height: '', goal: '', weight: '' }, weightHistory: []
};

let editMode = false;

function save() { localStorage.setItem('gymPPL_vUltimate', JSON.stringify(state)); }

function getBest(exName) {
    let maxKg = 0; let bestReps = 0;
    state.history.forEach(h => {
        h.exercises.forEach(ex => {
            if(ex.name === exName) {
                ex.sets.forEach(s => {
                    if(Number(s.kg) > maxKg) { maxKg = Number(s.kg); bestReps = s.reps; }
                });
            }
        });
    });
    return maxKg === 0 ? "0*0" : `${maxKg}*${bestReps}`;
}

function toggleEditMode() {
    editMode = !editMode;
    document.getElementById('editBtn').textContent = editMode ? "Done" : "Edit Mode";
    document.getElementById('workoutPage').classList.toggle('edit-mode', editMode);
    renderQuickBlocks();
}

function openWorkout(group) {
    state.activeGroup = group;
    document.getElementById('categoryPage').classList.remove('active');
    document.getElementById('workoutPage').classList.add('active');
    renderQuickBlocks(); renderWorkout();
}

function renderQuickBlocks() {
    const container = document.getElementById('quickBlocks'); container.innerHTML = '';
    state.customExercises[state.activeGroup].forEach((name, idx) => {
        const b = document.createElement('div');
        b.className = 'quick-block';
        b.style = "position:relative; background:var(--primary); color:white; padding:12px; border-radius:10px; text-align:center; font-weight:bold; cursor:pointer;";
        b.innerHTML = `<span>${name}</span><div class="edit-controls"><button class="icon-btn" onclick="event.stopPropagation(); renameEx(${idx})">‚úèÔ∏è</button><button class="icon-btn" onclick="event.stopPropagation(); deleteEx(${idx})">üóëÔ∏è</button></div>`;
        b.onclick = () => { if(!editMode) { state.currentExercises.push({name, sets:[{kg:'', reps:''}], finished: false}); renderWorkout(); } };
        container.appendChild(b);
    });
    const add = document.createElement('div');
    add.style = "background:#94a3b8; color:white; padding:12px; border-radius:10px; text-align:center; font-weight:bold; cursor:pointer;";
    add.textContent = "+ Add New";
    add.onclick = () => { const n = prompt("Exercise Name:"); if(n){ state.customExercises[state.activeGroup].push(n); save(); renderQuickBlocks(); } };
    container.appendChild(add);
}

function renameEx(i) { const n = prompt("Rename:", state.customExercises[state.activeGroup][i]); if(n){ state.customExercises[state.activeGroup][i]=n; save(); renderQuickBlocks(); } }
function deleteEx(i) { if(confirm("Delete?")){ state.customExercises[state.activeGroup].splice(i,1); save(); renderQuickBlocks(); } }

function renderWorkout() {
    const list = document.getElementById('exerciseList'); list.innerHTML = '';
    document.getElementById('sessionFinishBtn').style.display = state.currentExercises.length > 0 ? 'block' : 'none';
    
    state.currentExercises.forEach((ex, ei) => {
        const card = document.createElement('div');
        card.className = `exercise-card ${ex.finished ? 'minimized' : ''}`;
        if(ex.finished) {
            let bestThis = {kg:0, reps:0};
            ex.sets.forEach(s => { if(Number(s.kg) >= bestThis.kg) bestThis = s; });
            card.innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center;"><b>‚úÖ ${ex.name}</b> <small>Best: ${bestThis.kg}kg x ${bestThis.reps}</small></div>`;
        } else {
            const ghost = getBest(ex.name);
            card.innerHTML = `<div style="display:flex; justify-content:space-between;"><b>${ex.name}</b><span onclick="state.currentExercises.splice(${ei},1); renderWorkout()" style="color:var(--danger)">‚úï</span></div>
            <div id="sets-${ei}"></div>
            <button onclick="addSet(${ei})" style="width:100%; background:none; border:1px dashed #ccc; padding:8px; margin-top:10px; border-radius:8px;">+ Add Set</button>
            <button onclick="finishEx(${ei})" style="width:100%; background:var(--success); color:white; border:none; padding:10px; border-radius:8px; margin-top:10px; font-weight:bold;">FINISH EXERCISE</button>`;
            const setBox = card.querySelector(`#sets-${ei}`);
            ex.sets.forEach((s, si) => {
                const row = document.createElement('div'); row.className = 'set-row';
                row.innerHTML = `<small>${si+1}</small><div class="pr-ghost">${ghost}</div><input type="number" placeholder="kg" value="${s.kg}" oninput="state.currentExercises[${ei}].sets[${si}].kg=this.value"><input type="number" placeholder="reps" value="${s.reps}" oninput="state.currentExercises[${ei}].sets[${si}].reps=this.value"><span onclick="state.currentExercises[${ei}].sets.splice(${si},1); renderWorkout()">‚úï</span>`;
                setBox.appendChild(row);
            });
        }
        list.appendChild(card);
    });
    save();
}

function addSet(ei) { state.currentExercises[ei].sets.push({kg:'', reps:''}); renderWorkout(); }

function finishEx(ei) {
    state.currentExercises[ei].finished = true;
    document.getElementById('moteQuote').textContent = `"${quotes[Math.floor(Math.random()*quotes.length)]}"`;
    document.getElementById('motivationPopup').style.display = 'flex';
    renderWorkout();
}

function finishSession() {
    state.history.push({ 
        date: new Date().toISOString().split('T')[0], 
        displayDate: new Date().toLocaleDateString(), 
        exercises: JSON.parse(JSON.stringify(state.currentExercises)) 
    });
    state.currentExercises = []; save(); goHome();
}

function logWeight() {
    const val = document.getElementById('week-end-weight').value;
    if(val) { state.weightHistory.push({ val: parseFloat(val), date: new Date().toLocaleDateString() }); document.getElementById('week-end-weight').value = ''; save(); renderChart(); }
}

function renderChart() {
    const chart = document.getElementById('weightChart'); chart.innerHTML = '';
    const data = state.weightHistory.slice(-7);
    if(!data.length) return;
    const max = Math.max(...data.map(d => d.val)), min = Math.min(...data.map(d => d.val)), range = (max - min) || 5;
    data.forEach(d => {
        const b = document.createElement('div'); b.className = 'bar';
        b.style.height = `${((d.val - (min-1))/(range+1))*100}%`;
        b.setAttribute('data-val', d.val); chart.appendChild(b);
    });
}

function renderCalendar() {
    const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
    const now = new Date();
    const days = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
    for (let d = 1; d <= days; d++) {
        const dateStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const cell = document.createElement('div'); cell.className = 'cal-cell'; cell.textContent = d;
        const work = state.history.find(h => h.date === dateStr);
        if (work) { cell.classList.add('worked'); cell.onclick = () => openHistory(work); }
        grid.appendChild(cell);
    }
}

function openHistory(h) {
    document.getElementById('histDate').textContent = h.displayDate;
    // Modified to only show the BEST lift for each exercise performed that day
    document.getElementById('histBody').innerHTML = h.exercises.map(ex => {
        let dailyBest = {kg: 0, reps: 0};
        ex.sets.forEach(s => {
            if(Number(s.kg) > dailyBest.kg) { dailyBest.kg = Number(s.kg); dailyBest.reps = s.reps; }
        });
        return `<b>${ex.name}</b>: <span style="color:var(--success)">${dailyBest.kg}kg x ${dailyBest.reps}</span>`;
    }).join('<hr style="border:0; border-top:1px solid #eee; margin:5px 0;">');
    
    document.getElementById('historyPopup').style.display = 'flex';
}

function showProgression() {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('progressionPage').classList.add('active');
    document.getElementById('nav-home').classList.remove('active');
    document.getElementById('nav-prog').classList.add('active');
    document.getElementById('m-height').value = state.metrics.height;
    document.getElementById('m-goal').value = state.metrics.goal;
    document.getElementById('m-weight').value = state.metrics.weight;
    renderChart(); renderCalendar();
}

function updateMetric(k, v) { state.metrics[k] = v; save(); }

function goHome() {
    editMode = false;
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('categoryPage').classList.add('active');
    document.getElementById('nav-home').classList.add('active');
    document.getElementById('nav-prog').classList.remove('active');
    document.getElementById('mote-top').textContent = `"${quotes[Math.floor(Math.random()*quotes.length)]}"`;
}

goHome();
</script>
</body>
</html>